# Koerec - 高速音声コーパス作成ツール

## 概要
合成音声制作のための音声コーパス作成を効率化するWebアプリケーションです。大量の文章を読み上げて録音し、文章と音声ファイルを対応付けたデータセットを簡単に作成できます。

## 主要機能

### 1. 台本管理機能
- **台本セットの選択**: 事前定義された台本セットから選択
- **複数台本の選択**: 複数の台本を選択して1つの台本として統合
- **カスタム台本のアップロード**: ユーザー独自の台本ファイル（TXT）をアップロード
- **台本の編集**: ブラウザ上で台本の内容を編集可能
- **台本の保存**: 編集した台本をローカルストレージに保存

### 2. 録音機能
- **ワンクリック録音**: 録音ボタンで録音開始・停止
- **リアルタイム波形表示**: 録音中の音声レベルを視覚的に表示
- **録音品質の可視化**: 録音後の波形を表示して品質を確認
- **キーボードショートカット**: 
  - `Space`: 録音開始/停止/再録音
  - `Enter`: 次の文章へ進む
  - `P`: 録音音声の再生/一時停止
  - `Backspace`: 前の文章に戻る

### 3. 録音確認・管理機能
- **録音音声の再生**: 録音直後に音声を確認
- **再録音機能**: 気に入らない場合は簡単に再録音
- **進捗の保存**: ブラウザを閉じても進捗が保持される
- **セッションの再開**: 前回の続きから録音を再開可能

### 4. データエクスポート機能
- **エクスポート形式の選択**: 初期画面で出力形式を選択可能
- **複数形式でのエクスポート**:
  - ZIPファイル（音声ファイル + 対応表）
  - TXTファイル（音声ファイル名|話者名|言語|文章内容の形式）
- **ファイル名の自動生成**: 連番付きのファイル名を自動生成
- **メタデータの付与**: 録音日時、台本情報などのメタデータを付与

## 技術仕様

### フロントエンド
- **HTML5**: セマンティックなマークアップ
- **CSS3**: Tailwind CSSを使用したレスポンシブデザイン
- **JavaScript (ES6+)**: モダンなJavaScript機能を活用
- **Web APIs**:
  - MediaRecorder API: 音声録音
  - Web Audio API: 音声解析・可視化
  - IndexedDB: ローカルデータ保存
  - File API: ファイルの読み込み・ダウンロード

### データ保存
- **ローカルストレージ**: 進捗情報の保存
- **IndexedDB**: 録音データの保存
- **サーバーサイド保存なし**: プライバシー保護のため、すべてのデータはローカルに保存

### 対応ブラウザ
- Chrome 60+
- Firefox 55+
- Safari 11+
- Edge 79+

## ユーザーインターフェース

### 画面構成
1. **初期画面**: 台本選択・エクスポート形式選択・設定
2. **録音画面**: メインの録音作業画面
3. **完了画面**: データダウンロード・管理

### UI要素（HTML5標準要素を活用）
- **録音ボタン**: 大きな円形ボタンで録音状態を視覚的に表示
- **波形表示**: リアルタイム・録音後の波形を表示
- **進捗表示**: HTML5の`<progress>`要素を使用
- **音声再生**: HTML5の`<audio>`要素をそのまま使用
- **ファイル選択**: HTML5の`<input type="file">`を使用
- **選択UI**: HTML5の`<select>`要素を使用
- **ショートカットガイド**: キーボードショートカットの表示

### 台本選択UI設計

#### 基本構成
- **統一リスト表示**: 事前定義台本とカスタム台本を同じリスト形式で表示
- **チェックボックス選択**: 各項目にチェックボックスを配置し、複数選択可能
- **動的リスト更新**: カスタム台本の追加・編集時にリストが自動更新

#### UI要素
- **台本リスト**: スクロール可能なリストで全台本を表示
- **項目表示**: 台本名、文章数のみを表示
- **削除ボタン**: ローカルストレージに保存されたカスタム台本のみに削除ボタンを配置
- **保存ボタン**: 台本エディタ内に「台本を保存」ボタンを配置

#### 挙動統一
- **インポート時**: ファイル選択後、ローカルストレージに保存してリストに新項目が自動追加
- **保存時**: 台本エディタで編集後、保存ボタンでローカルストレージに保存してリストに反映
- **削除時**: 確認ダイアログ後、ローカルストレージから削除してリストから項目を削除

## セキュリティ・プライバシー

### データ保護
- **ローカル保存のみ**: 録音データはサーバーに送信されません
- **暗号化**: 機密性の高いデータは暗号化して保存
- **データ削除**: ユーザーが明示的に削除するまでデータを保持

### アクセス権限
- **マイクアクセス**: 録音機能に必要な最小限の権限
- **ローカルストレージ**: 進捗保存のための権限

## パフォーマンス要件

### 録音品質
- **サンプルレート**: 44.1kHz
- **ビット深度**: 16bit
- **フォーマット**: WAV形式

### レスポンス時間
- **録音開始**: 1秒以内
- **音声再生**: 即座に開始
- **データエクスポート**: 10秒以内（100文程度）

## 今後の拡張予定

### 機能拡張
- **音声品質チェック**: 自動的な音声品質の評価
- **複数台本の合体**: 複数台本を選択して1つの台本として統合処理
- **統計機能**: 録音時間、進捗率などの統計表示

### UI/UX改善
- **ダークモード**: 長時間使用時の目の負担軽減
- **アクセシビリティ**: スクリーンリーダー対応
- **多言語対応**: 英語、中国語などの対応

## ファイル構成

### 構成
```
koerec/
├── index.html                 # メインアプリケーション（全機能統合）
├── scripts/
│   ├── basic_set.txt         # 基本台本セット
│   ├── emotion_set.txt       # 感情表現台本セット
│   └── custom/               # ユーザーアップロード台本格納
├── config/
│   └── export_formats.json   # エクスポート形式定義（将来の拡張用）
└── README.md                 # このファイル
```

### 主要ファイルの役割

#### 1. index.html
- **全機能統合**: 現在のsample.htmlと同様に、すべての機能を1ファイルに統合
- **台本選択**: 事前定義台本の選択、カスタム台本のアップロード
- **エクスポート形式選択**: 初期画面での形式選択
- **録音機能**: 音声録音、波形表示、再生確認
- **データ管理**: IndexedDBによる進捗保存
- **エクスポート**: ZIPファイル生成、TXTファイル出力

#### 2. scripts/*.txt
- **事前定義台本**: 基本セット、感情表現セットなど
- **1行1文章**: 1行に1つの文章を記述
- **UTF-8エンコーディング**: 日本語対応

### 設計思想

#### シンプルさを重視
- **1ファイル構成**: 現在のsample.htmlと同様の構成を維持
- **HTML5標準要素の活用**: カスタムUIの代わりに標準要素を使用
- **外部依存最小化**: CDNライブラリのみ使用
- **設定の内部化**: エクスポート形式はJavaScript内で定義

#### HTML5標準要素の活用例
- **音声再生**: `<audio controls>`でブラウザ標準の再生UIを使用
- **進捗表示**: `<progress value="50" max="100">`で標準の進捗バーを使用
- **ファイル選択**: `<input type="file" accept=".txt">`で標準のファイル選択UIを使用
- **選択UI**: `<select>`で標準のドロップダウンを使用

#### 将来の拡張性
- **モジュール化の準備**: 必要に応じてファイル分割可能
- **設定ファイルの追加**: 複雑になった場合の設定外部化
- **機能の段階的追加**: 必要最小限から始めて段階的に拡張

## 開発・運用

### 開発環境
- **ローカル開発**: ブラウザのみで動作
- **デプロイ**: 静的ファイルのホスティング
- **依存関係**: CDN経由でのライブラリ読み込み

### メンテナンス
- **定期更新**: ブラウザAPIの変更に対応
- **バグ修正**: ユーザーフィードバックに基づく改善
- **機能追加**: ユーザー要望に基づく新機能の実装

---

## 使用方法

1. ブラウザでアプリケーションを開く
2. 台本セットを選択（複数選択可能）またはカスタム台本をアップロード
3. エクスポート形式を選択（TXT形式）
4. 「録音開始」ボタンをクリック
5. 表示された文章を読み上げ、録音ボタンで録音
6. 録音音声を確認し、必要に応じて再録音
7. Enterキーで次の文章へ進む
8. 全文章の録音完了後、データをダウンロード

## 複数台本の統合機能

複数の台本を選択した場合、以下のように処理されます：

- **台本の統合**: 選択された複数台本の文章を順番に結合
- **連続録音**: 統合された台本を1つのセッションとして録音
- **統一出力**: すべての録音データを1つのZIPファイルとTXTファイルで出力
- **進捗管理**: 統合台本全体での進捗を表示

## 出力ファイル形式

### TXTファイル形式
```
audio_0001.wav|test_speaker|JP|こんにちは！今日はいい天気ですね！
audio_0002.wav|test_speaker|JP|昨日行ったレストランとってもおいしかったね！
```

- **ファイル名**: `audio_XXXX.wav` (XXXXは4桁の連番)
- **話者名**: 設定可能（デフォルト: test_speaker）
- **言語**: 設定可能（デフォルト: JP）
- **文章内容**: 録音した文章

## 注意事項

- 録音データはローカルに保存されるため、ブラウザのデータを削除すると録音データも失われます
- 大量の録音データはブラウザのストレージ容量を消費します
- 定期的にデータをエクスポートしてバックアップを取ることを推奨します